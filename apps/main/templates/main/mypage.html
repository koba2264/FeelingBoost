{% extends "main/base.html" %}
{% block content %}
  <link href="{{ url_for('static', filename='main/mypage_style.css') }}" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>
<body>
<div class="nav-links">
  <a href="{{ url_for('main.menu') }}">戻る</a><br>
  <a href="{{ url_for('auth.logout') }}">ログアウト</a>
</div>


  <div class="card">
    <div class="graph-and-info">
      <!-- グラフ -->
      <div class="chart-container">
        <canvas id="myChart"></canvas>
      </div>

      <!-- 右側：info + gacha -->
      <div class="right-section">
        <!-- 画像と情報 -->
        <div class="user-info">
          <img src="{{ url_for('main.profile_image') }}" alt="プロフィール画像" class="myimage">
          <div class="user-table">
            <h2>{{ username }} さん</h2>
            <p><strong>ポイント：</strong> {{ point }}</p>
          </div>
        </div>

        <!-- ガチャ画像 -->
        <a href="{{ url_for('gacha.home') }}">
          <div class="gacha">
            <img id="gacha_image" src="{{ url_for('static', filename='main/gacha.png') }}">
          </div>
        </a>
      </div>
    </div>
  </div>




  <script>
    const date = {{ format_date | tojson }};
    const count = {{ count_list | tojson }};
    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: date,
        datasets: [{
          label: '達成タスク数',
          data: count,
          backgroundColor: 'rgba(60, 150, 120, 0.2)',
          borderColor: '#3c9678',
          borderWidth: 2,
          pointBackgroundColor: '#2f6653',
          pointBorderColor: '#2f6653',
          tension: 0 // ← 直線に！
        }]
      },
      options: {
        responsive: false,
        plugins: {
          legend: {
            labels: {
              color: '#2c3e3a',
              font: { size: 14 },
              usePointStyle: true,      
              pointStyle: 'line'
            },
            onClick: (e) => e.stopPropagation()
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#2c3e3a',
              font: { size: 12 }
            }
          },
          y: {
            min: 0,
            max: 3,
            beginAtZero: true,
            ticks: {
              stepSize: 1,
              color: '#2c3e3a',
              font: { size: 12 }
            }
          }
        }
      }
    });
  </script>
{% endblock content %}